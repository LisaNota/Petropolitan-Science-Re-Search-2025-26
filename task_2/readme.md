# Задание 2. Смена сезонов

## Постановка задачи

Имеются две фотографии пейзажей с клёнами, снятые в разных местах:

- `Photo1.jpg` — осенний пейзаж  
- `Photo2.jpg` — летний пейзаж  

Требуется предложить алгоритм и реализовать программу, которая:

1) «превращает» осенний пейзаж в летний (Photo1 → Summer)  
2) «превращает» летний пейзаж в осенний (Photo2 → Autumn)

Результат работы программы — два изображения:

- `Summer.jpg` — результат обработки `Photo1.jpg`  
- `Autumn.jpg` — результат обработки `Photo2.jpg`

Алгоритм должен сопровождаться подробным описанием и оценкой достоинств/недостатков.

---

## Идея решения

Задача смены сезона — это частный случай **переноса цветового стиля** (style transfer), когда геометрия сцены сохраняется, а меняются цветовые характеристики (оттенок/насыщенность/яркость) в «сезонно-зависимых» областях:

- листва/трава (лето: зелёные оттенки)
- листва/земля (осень: оранжево-жёлтые оттенки)
- стволы (в некоторых условиях могут «зеленить» и требуют отдельной коррекции)

В данном решении используется **классический, интерпретируемый подход**:

1) **Сегментация по эвристикам** (маски неба, стволов и областей перекраски)  
2) **Преобразование цвета в HSV** и управление:
   - Hue (тон): перевод зелёного диапазона в «осенний», и наоборот
   - Saturation/Value: подгонка распределений (mean/std) к референсу  
3) **Мягкое смешивание (alpha-blending)** через размытую альфу, чтобы не было резких границ  
4) **Защита неба/облаков** (чтобы светлые области не окрашивались)

Такой метод:
- не требует обучения и датасетов,
- воспроизводим, быстр и прозрачен,
- но зависит от качества масок и параметров порогов.

---

## Возможные альтернативы

### 1) CycleGAN / pix2pix / диффузионные модели (нейросетевой style transfer)
**Плюсы:** более «естественные» результаты на широком классе сцен  
**Минусы:** нужен датасет, обучение/инференс тяжелее, трудно гарантировать детерминизм, сложнее объяснить и отладить, результат менее интерпретируем.

### 2) Глобальный color transfer (Reinhard в Lab, histogram matching)
**Плюсы:** просто, быстро  
**Минусы:** окрашивает всё сразу (включая небо), часто ломает сцену при разных локациях/освещении.

### 3) Выбранный подход (эвристики + HSV + маски + blend)
**Плюсы:** детерминированный, объяснимый, быстро работает, легко повторить, легко менять пороги  
**Минусы:** чувствителен к сцене; если цвета/освещение сильно отличаются, маски могут быть неточными.

---

## Алгоритм (описание процесса)

### A. Photo1 (Autumn) → Summer
1) Находим **небо/облака** (mask sky)  
2) находим **стволы/ветви** (mask trunk)  
3) Строим маску области перекраски (в итоговой реализации используется «всё кроме неба», чтобы гарантировать перекраску в нужный сезон при разных локациях)  
4) Перекрашиваем область в HSV:
   - Hue переводим в диапазон зелени
   - S,V подгоняем к статистике летнего фото (Photo2)
5) Строим мягкую альфу, защищаем небо/облака, смешиваем

### B. Photo2 (Summer) → Autumn
1) Находим **небо/облака**  
2) Находим **стволы/ветви**  
3) Перекрашиваем «всё кроме неба»:
   - Hue: зелёный диапазон → осенний диапазон
   - S,V: подгоняем к статистике осеннего фото (Photo1)
4) Отдельно корректируем стволы (убираем зелёный оттенок и слегка «согреваем»)
5) Строим мягкую альфу и смешиваем

---

## Структура папки

В папке `task_2` находятся:

- `readme.md` — описание задачи и состава решения  
- `solution.ipynb` — ход решения с пояснениями, визуализациями масок/альф/промежуточных результатов  
- `main.py` — воспроизводимый скрипт, генерирующий `Summer.jpg` и `Autumn.jpg`  
- `Summer.jpg` — итог `Photo1.jpg → Summer.jpg`  
- `Autumn.jpg` — итог `Photo2.jpg → Autumn.jpg`  
- `src/` — модули с функциями (все функции содержат докстринги и комментарии)

### `src/features/`
- `sky_mask.py` — маска неба/облаков
- `trunk_mask.py` — маска стволов/ветвей
- `exg_gradmag.py` — признаки ExG и градиентная текстура (Sobel magnitude)
- `fill_holes.py` — заливка "полостей" в масках + очистка мелких компонент
- `protect_bright.py` — защита ярких областей (облака/просветы) от окрашивания
- `recoloring.py` — перекраска в HSV (Hue + матчинг S/V по mean/std), map_green_to_autumn и пр.
- `fol_ground.py` — маски кроны/земли
- `__init__.py` — экспорт функций

### `src/utils/`
- `__init__.py` — утилиты/вспомогательные функции (визуализация, конвертация BGR→RGB и т.п.)

---

## Как запустить

### 1) Зависимости
Нужны Python-библиотеки:
- `opencv-python`
- `numpy`
- (для ноутбука) `matplotlib`

Пример установки:
```bash
pip install opencv-python numpy matplotlib
```

### 2) Входные данные
Положите исходные изображения в:
- `data/task-2/Photo1.jpg`
- `data/task-2/Photo2.jpg`

(пути соответствуют значениям в main.py; при необходимости можно изменить их в начале файла)


### 3) Запуск скрипта
Из директории task_2:
`python main.py`

После выполнения появятся:
- `Summer.jpg` — летняя версия осеннего фото: листва/трава переводятся к зелёному тону, сохраняется структура и освещение сцены
- `Autumn.jpg` — осенняя версия летнего фото: зелёный тон переводится в оранжево-жёлтый диапазон; отдельно корректируются стволы

## Достоинства и недостатки

### Достоинства

- Без обучения: не нужны датасеты и GPU
- Быстро: работает за доли секунды на CPU
- Интерпретируемо: каждый шаг объясним (маски → HSV → blend)
- Воспроизводимо: детерминированный результат при фиксированных параметрах

### Недостатки

- Зависимость от условий съёмки: при другом освещении/цветовом балансе пороги могут требовать подстройки
- Маски эвристические: возможны ошибки на сложных сценах (другие деревья, нетипичные оттенки, сильные тени)
- Реализм ограничен: метод меняет цвет, но не моделирует «физику сезона» (плотность листвы, опадание, иней и т.п.)

